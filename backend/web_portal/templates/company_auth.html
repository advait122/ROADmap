{% extends "base.html" %}
{% block title %}Company Access | CodeMap{% endblock %}
{% block body_class %}onboarding-page company-page company-auth-page company-login-page{% endblock %}
{% block page_styles %}
<link href="/static/css/onboarding.css?v={{ asset_version }}" rel="stylesheet">
<link href="/static/css/company.css?v={{ asset_version }}" rel="stylesheet">
{% endblock %}
{% block content %}
<section class="setup-shell company-auth-shell">
    <div class="setup-card setup-card-modern company-auth-layout">
        <div class="setup-left setup-left-showcase company-showcase">
            <div class="showcase-brand codemap-wordmark">CodeMap</div>

            <div class="talent-stack" aria-hidden="true">
                <article class="talent-chip-card">
                    <div class="talent-avatar">DB</div>
                    <div class="talent-meta">
                        <h4>Dhruv Bhatia</h4>
                        <div class="talent-tags">
                            <span>Python</span>
                            <span>DSA</span>
                            <span>ML</span>
                        </div>
                    </div>
                    <div class="talent-score">94%<small>match</small></div>
                </article>

                <article class="talent-chip-card">
                    <div class="talent-avatar is-green">SR</div>
                    <div class="talent-meta">
                        <h4>Sneha Rao</h4>
                        <div class="talent-tags">
                            <span>Java</span>
                            <span>Spring</span>
                            <span>SQL</span>
                        </div>
                    </div>
                    <div class="talent-score">88%<small>match</small></div>
                </article>

                <article class="talent-chip-card">
                    <div class="talent-avatar is-blue">AK</div>
                    <div class="talent-meta">
                        <h4>Arjun Kumar</h4>
                        <div class="talent-tags">
                            <span>JS</span>
                            <span>React</span>
                            <span>Node</span>
                        </div>
                    </div>
                    <div class="talent-score">81%<small>match</small></div>
                </article>
            </div>

            <div class="setup-copy setup-copy-showcase">
                <h3>Find the right talent,</h3>
                <h3>faster than ever.</h3>
                <p>Shortlist top candidates based on skills, test scores, and consistency.</p>
            </div>
        </div>

        <div class="setup-right setup-right-modern company-auth-right">
            <p class="company-auth-kicker">Company Console</p>
            <h2 class="setup-title">Welcome back</h2>
            <p class="setup-subtitle">Sign in to post roles and discover top candidates.</p>

            <nav class="company-auth-tabs" aria-label="Company auth tabs">
                <a href="/company/auth" class="company-auth-tab is-active">Login</a>
                <a href="/company/signup" class="company-auth-tab">Sign Up</a>
            </nav>

            <div id="companyLoginError" class="alert alert-danger mb-3{% if not error %} d-none{% endif %}">
                {{ error }}
            </div>

            <section class="company-auth-card company-auth-card-single">
                <form id="companyLoginForm" method="post" action="/company/login" class="company-auth-form">
                    <div class="mb-3">
                        <label class="form-label">Username</label>
                        <input
                            type="text"
                            name="username"
                            id="companyLoginUsername"
                            class="form-control onboarding-input"
                            placeholder="your@company.com"
                            required
                        >
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Password</label>
                        <input
                            type="password"
                            name="password"
                            id="companyLoginPassword"
                            class="form-control onboarding-input"
                            placeholder="........"
                            required
                        >
                    </div>
                    <div class="company-auth-actions">
                        <button type="submit" class="btn btn-primary step-btn company-auth-primary">Login</button>
                    </div>
                </form>

                <div class="company-auth-divider"><span>or</span></div>

                <a href="/company/signup" class="btn btn-outline-secondary step-btn company-auth-secondary">
                    Create a company account
                </a>
                <p class="company-auth-footnote">
                    Are you a student?
                    <a href="/onboarding">Student login -></a>
                </p>
            </section>
        </div>
    </div>
</section>
<script>
    (function () {
        const form = document.getElementById("companyLoginForm");
        const errorBox = document.getElementById("companyLoginError");
        const passwordInput = document.getElementById("companyLoginPassword");
        if (!form || !errorBox || !passwordInput) return;

        form.addEventListener("submit", async (event) => {
            event.preventDefault();
            const submitBtn = form.querySelector('button[type="submit"]');
            if (submitBtn) submitBtn.disabled = true;

            try {
                const response = await fetch(form.action, {
                    method: "POST",
                    body: new FormData(form),
                    credentials: "same-origin",
                    headers: { "X-Requested-With": "XMLHttpRequest" },
                });

                const data = await response.json().catch(() => ({}));
                if (!response.ok || !data.ok) {
                    throw new Error(data.error || "Invalid login credentials.");
                }

                window.location.href = data.redirect_url || "/company/dashboard";
            } catch (error) {
                errorBox.textContent = error && error.message ? error.message : "Invalid login credentials.";
                errorBox.classList.remove("d-none");
                passwordInput.value = "";
                passwordInput.focus();
            } finally {
                if (submitBtn) submitBtn.disabled = false;
            }
        });
    })();
</script>
{% endblock %}
