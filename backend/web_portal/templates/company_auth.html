{% extends "base.html" %}
{% block title %}Company Access | CodeMap{% endblock %}
{% block body_class %}onboarding-page company-page{% endblock %}
{% block page_styles %}
<link href="/static/css/onboarding.css?v={{ asset_version }}" rel="stylesheet">
<link href="/static/css/company.css?v={{ asset_version }}" rel="stylesheet">
{% endblock %}
{% block content %}
<section class="setup-shell">
    <div class="setup-card">
        <div class="setup-left">
            <div class="art-layer"></div>
            <div class="setup-copy">
                <h3>Company Console</h3>
                <p>Find the right students based on skills, test scores, and consistency.</p>
            </div>
        </div>

        <div class="setup-right">
            <h2 class="setup-title">Login as Company</h2>
            <p class="setup-subtitle">Sign in to post roles and shortlist top candidates.</p>

            <div id="companyLoginError" class="alert alert-danger mb-3{% if not error %} d-none{% endif %}">
                {{ error }}
            </div>

            <section class="company-auth-card company-auth-card-single">
                <form id="companyLoginForm" method="post" action="/company/login">
                    <div class="mb-3">
                        <label class="form-label">Username</label>
                        <input
                            type="text"
                            name="username"
                            id="companyLoginUsername"
                            class="form-control onboarding-input"
                            required
                        >
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Password</label>
                        <input
                            type="password"
                            name="password"
                            id="companyLoginPassword"
                            class="form-control onboarding-input"
                            required
                        >
                    </div>
                    <div class="company-auth-actions">
                        <button type="submit" class="btn btn-primary step-btn">Login</button>
                        <a href="/company/signup" class="btn btn-outline-secondary step-btn">Sign Up</a>
                    </div>
                </form>
            </section>
        </div>
    </div>
</section>
<script>
    (function () {
        const form = document.getElementById("companyLoginForm");
        const errorBox = document.getElementById("companyLoginError");
        const passwordInput = document.getElementById("companyLoginPassword");
        if (!form || !errorBox || !passwordInput) return;

        form.addEventListener("submit", async (event) => {
            event.preventDefault();
            const submitBtn = form.querySelector('button[type="submit"]');
            if (submitBtn) submitBtn.disabled = true;

            try {
                const response = await fetch(form.action, {
                    method: "POST",
                    body: new FormData(form),
                    credentials: "same-origin",
                    headers: { "X-Requested-With": "XMLHttpRequest" },
                });

                const data = await response.json().catch(() => ({}));
                if (!response.ok || !data.ok) {
                    throw new Error(data.error || "Invalid login credentials.");
                }

                window.location.href = data.redirect_url || "/company/dashboard";
            } catch (error) {
                errorBox.textContent = error && error.message ? error.message : "Invalid login credentials.";
                errorBox.classList.remove("d-none");
                passwordInput.value = "";
                passwordInput.focus();
            } finally {
                if (submitBtn) submitBtn.disabled = false;
            }
        });
    })();
</script>
{% endblock %}
