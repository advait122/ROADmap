<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}CodeMap{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/base.css?v={{ asset_version }}" rel="stylesheet">
    {% block page_styles %}{% endblock %}
</head>
<body class="{% block body_class %}{% endblock %}">
    {% set chat_ctx = chatbot_context if chatbot_context is defined else (dashboard.chatbot if dashboard is defined else None) %}
    <nav class="navbar navbar-expand-lg bg-white border-bottom mb-4">
        <div class="container">
            {% set brand_href = "/" %}
            {% if company is defined and company and not student %}
                {% set brand_href = "/company/dashboard" %}
            {% endif %}
            <a href="{{ brand_href }}" class="navbar-brand fw-semibold text-decoration-none codemap-wordmark">CodeMap</a>
            {% if student %}
                {% set dashboard_url = "/students/" ~ student.id ~ "/dashboard" %}
                {% set current_section = active_section if active_section else "roadmap" %}
                {% set notification_items = [] %}
                {% if dashboard is defined and dashboard and dashboard.notifications is defined %}
                    {% set notification_items = dashboard.notifications %}
                {% endif %}
                {% set year_suffix = {1: 'st', 2: 'nd', 3: 'rd'}.get(student.current_year, 'th') %}
                <div class="ribbon-nav" role="navigation" aria-label="Dashboard Sections">
                    <a href="{{ dashboard_url }}?section=roadmap" class="ribbon-link {% if current_section == 'roadmap' %}active{% endif %}">Progress Dashboard</a>
                    <a href="{{ dashboard_url }}?section=tasks" class="ribbon-link {% if current_section == 'tasks' %}active{% endif %}">Tasks</a>
                    <a href="{{ dashboard_url }}?section=tests" class="ribbon-link {% if current_section == 'tests' %}active{% endif %}">Tests</a>
                    {% if dashboard is defined %}
                    <div class="ribbon-playlist-dropdown" id="ribbonPlaylistDropdown">
                        <button
                            type="button"
                            class="ribbon-playlist-toggle"
                            id="ribbonPlaylistToggle"
                            aria-controls="ribbonPlaylistPanel"
                            aria-expanded="false"
                        >
                            Current Playlist
                            <span class="ribbon-playlist-caret" aria-hidden="true"></span>
                        </button>
                        <section
                            id="ribbonPlaylistPanel"
                            class="ribbon-playlist-panel"
                            role="dialog"
                            aria-modal="false"
                            aria-labelledby="ribbonPlaylistTitle"
                            aria-hidden="true"
                        >
                            <header class="ribbon-playlist-header">
                                <h3 id="ribbonPlaylistTitle" class="ribbon-playlist-title mb-0">Current Skill Playlist</h3>
                                {% if dashboard.active_skill %}
                                    <p class="ribbon-playlist-subtitle mb-0">{{ dashboard.active_skill.skill_name }}</p>
                                {% endif %}
                            </header>

                            {% if dashboard.active_skill %}
                                {% if dashboard.active_skill_recommendations %}
                                    <div class="ribbon-playlist-list">
                                        {% for item in dashboard.active_skill_recommendations %}
                                            <article class="ribbon-playlist-item {% if item.is_selected == 1 %}is-selected{% endif %}">
                                                <div class="ribbon-playlist-item-top">
                                                    <div class="ribbon-playlist-item-copy">
                                                        {% if item.playlist_url %}
                                                            <a
                                                                class="ribbon-playlist-item-title ribbon-playlist-item-title-link"
                                                                href="{{ item.playlist_url }}"
                                                                target="_blank"
                                                                rel="noreferrer noopener"
                                                            >
                                                                {{ item.title }}
                                                            </a>
                                                        {% else %}
                                                            <div class="ribbon-playlist-item-title">{{ item.title }}</div>
                                                        {% endif %}
                                                        {% set channel_href = item.summary.channel_url if item.summary and item.summary.channel_url else item.playlist_url %}
                                                        <div class="ribbon-playlist-item-channel">
                                                            Channel:
                                                            {% if channel_href %}
                                                                <a href="{{ channel_href }}" target="_blank" rel="noreferrer noopener">
                                                                    {{ item.channel_title or "Open Channel" }}
                                                                </a>
                                                            {% else %}
                                                                {{ item.channel_title }}
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                    <form
                                                        method="post"
                                                        action="/students/{{ student.id }}/skills/{{ dashboard.active_skill.id }}/playlist/select?section={{ current_section }}"
                                                        class="ribbon-playlist-form"
                                                    >
                                                        <input type="hidden" name="recommendation_id" value="{{ item.id }}">
                                                        <button
                                                            class="btn btn-sm {% if item.is_selected == 1 %}btn-success{% else %}btn-outline-primary{% endif %}"
                                                            type="submit"
                                                        >
                                                            {% if item.is_selected == 1 %}Selected{% else %}Select{% endif %}
                                                        </button>
                                                    </form>
                                                </div>

                                                <div class="ribbon-playlist-actions">
                                                    <button
                                                        type="button"
                                                        class="btn btn-sm btn-outline-primary ribbon-playlist-summary-btn playlist-summary-open-btn"
                                                        data-summary-title="Topic Overview"
                                                        data-summary-content="{{ item.summary_human.topic_overview | tojson | forceescape }}"
                                                    >
                                                        Topic Overview
                                                    </button>
                                                    <button
                                                        type="button"
                                                        class="btn btn-sm btn-outline-primary ribbon-playlist-summary-btn playlist-summary-open-btn"
                                                        data-summary-title="Learning Experience"
                                                        data-summary-content="{{ item.summary_human.learning_experience | tojson | forceescape }}"
                                                    >
                                                        Learning Exp
                                                    </button>
                                                    <button
                                                        type="button"
                                                        class="btn btn-sm btn-outline-primary ribbon-playlist-summary-btn playlist-summary-open-btn"
                                                        data-summary-title="Topics Covered"
                                                        data-summary-content="{{ item.summary_human.topics_covered_summary | tojson | forceescape }}"
                                                    >
                                                        Topics Covered
                                                    </button>
                                                </div>
                                            </article>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <p class="ribbon-playlist-empty mb-0">
                                        {% if dashboard.playlist_recommendation_error %}
                                            {{ dashboard.playlist_recommendation_error }}
                                        {% else %}
                                            No playlist suggestions available yet.
                                        {% endif %}
                                    </p>
                                {% endif %}
                            {% else %}
                                <p class="ribbon-playlist-empty mb-0">All roadmap skills are completed.</p>
                            {% endif %}
                        </section>
                    </div>
                    {% endif %}
                    <a href="{{ dashboard_url }}?section=opportunities" class="ribbon-link {% if current_section == 'opportunities' %}active{% endif %}">Opportunities</a>
                </div>
                <div class="topbar-actions">
                    <div class="notification-shell">
                        <button
                            type="button"
                            class="notification-toggle"
                            id="notificationToggle"
                            aria-label="Open notifications"
                            aria-expanded="false"
                        >
                            <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                                <path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"></path>
                                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                            </svg>
                            {% if notification_items %}
                                <span class="notification-badge">{{ notification_items | length }}</span>
                            {% endif %}
                        </button>
                        <div
                            class="notification-panel"
                            id="notificationPanel"
                            aria-hidden="true"
                        >
                            <div class="notification-panel-header">Notifications</div>
                            <div class="notification-panel-body">
                                {% if notification_items %}
                                    {% for note in notification_items %}
                                        <details class="notification-item">
                                            <summary class="notification-item-summary">
                                                <span class="notification-item-title">{{ note.ui_title or note.title }}</span>
                                                <span class="notification-item-chevron" aria-hidden="true">&#8250;</span>
                                            </summary>
                                            <div class="notification-item-detail">
                                                {% if note.ui_link_text and note.ui_link_url %}
                                                    {{ note.ui_detail_prefix or "" }}
                                                    <a
                                                        href="{{ note.ui_link_url }}"
                                                        target="_blank"
                                                        rel="noreferrer"
                                                        class="notification-item-link"
                                                    >
                                                        {{ note.ui_link_text }}
                                                    </a>
                                                    {{ note.ui_detail_suffix or "" }}
                                                {% else %}
                                                    {{ note.ui_detail or note.body }}
                                                {% endif %}
                                            </div>
                                        </details>
                                    {% endfor %}
                                {% else %}
                                    <p class="notification-empty">No notifications yet.</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="profile-shell">
                        <button
                            type="button"
                            class="profile-toggle"
                            id="profileToggle"
                            aria-label="Open profile info"
                            aria-expanded="false"
                        >
                            <svg viewBox="0 0 16 16" aria-hidden="true" focusable="false">
                                <path d="M8 8.5A2.5 2.5 0 1 0 8 3.5a2.5 2.5 0 0 0 0 5Zm-4.25 3c0-1.2 1.32-2.25 4.25-2.25s4.25 1.05 4.25 2.25V12H3.75v-.5ZM0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-7a7 7 0 1 0 0 14A7 7 0 0 0 8 1Z"/>
                            </svg>
                        </button>
                        <div
                            class="profile-panel"
                            id="profilePanel"
                            aria-hidden="true"
                        >
                            <p class="profile-panel-name">{{ student.name }}</p>
                            <p class="profile-panel-line"><span class="profile-label">Branch:</span> {{ student.branch }}</p>
                            <p class="profile-panel-line"><span class="profile-label">Year:</span> {{ student.current_year }}{{ year_suffix }} Year</p>
                            <a href="/onboarding" class="btn btn-sm btn-outline-secondary profile-action-btn">Create New Plan</a>
                        </div>
                    </div>
                </div>
            {% elif company is defined and company and not student and request.url.path == "/company/dashboard" %}
                {% set company_section = active_company_section if active_company_section is defined else "dashboard" %}
                {% set active_company_job_id = company_dashboard.active_job.id if company_dashboard is defined and company_dashboard.active_job is defined and company_dashboard.active_job else None %}
                {% set active_company_top = company_dashboard.top_filter if company_dashboard is defined and company_dashboard.top_filter is defined else 20 %}
                <div class="ribbon-nav" role="navigation" aria-label="Company Dashboard Sections">
                    <a
                        href="/company/dashboard?section=dashboard{% if active_company_job_id %}&job_id={{ active_company_job_id }}{% endif %}&top={{ active_company_top }}"
                        class="ribbon-link {% if company_section == 'dashboard' %}active{% endif %}"
                    >
                        Dashboard
                    </a>
                    <a
                        href="/company/dashboard?section=eligible{% if active_company_job_id %}&job_id={{ active_company_job_id }}{% endif %}&top={{ active_company_top }}"
                        class="ribbon-link {% if company_section == 'eligible' %}active{% endif %}"
                    >
                        Eligible Students
                    </a>
                    <a
                        href="/company/dashboard?section=applied{% if active_company_job_id %}&job_id={{ active_company_job_id }}{% endif %}&top={{ active_company_top }}"
                        class="ribbon-link {% if company_section == 'applied' %}active{% endif %}"
                    >
                        Applied Students
                    </a>
                </div>
                <div class="topbar-actions">
                    <form method="post" action="/company/logout" class="company-topbar-logout-form">
                        <button type="submit" class="company-topbar-logout-btn">Logout</button>
                    </form>
                </div>
            {% elif request.url.path in ["/company/auth", "/company/signup"] %}
                <div class="ribbon-nav" aria-hidden="true"></div>
                <div class="topbar-actions">
                    <a id="ribbonStudentBtn" href="/onboarding" class="ribbon-company-link">
                        Login as Student
                    </a>
                </div>
            {% elif request.url.path == "/onboarding" %}
                <div class="ribbon-nav" aria-hidden="true"></div>
                <div class="topbar-actions">
                    <a
                        id="ribbonCompanyBtn"
                        href="/company/auth"
                        class="ribbon-company-link"
                    >
                        Login as Company
                    </a>
                </div>
            {% endif %}
        </div>
    </nav>

    <main class="container pb-5">
        {% block content %}{% endblock %}
    </main>
    {% if dashboard is defined %}
    <div id="summaryModalOverlay" class="summary-modal-overlay" aria-hidden="true">
        <div class="summary-modal-card" role="dialog" aria-modal="true" aria-labelledby="summaryModalTitle">
            <div class="summary-modal-header">
                <h4 id="summaryModalTitle" class="summary-modal-title mb-0">Summary</h4>
                <button type="button" class="btn-close" aria-label="Close" id="summaryModalClose"></button>
            </div>
            <div id="summaryModalBody" class="summary-modal-body"></div>
        </div>
    </div>
    {% endif %}
    {% if student and chat_ctx %}
    {% set chat_section = active_section if active_section else "tasks" %}
    <div id="doubtbot-widget" class="doubtbot-widget">
        <button
            type="button"
            class="doubtbot-launcher"
            id="doubtbotLauncher"
            aria-label="Open DoubtBot chat"
            aria-controls="doubtbotPanel"
            aria-expanded="false"
        ></button>
        <span class="doubtbot-launcher-label">DoubtBot</span>

        <section
            id="doubtbotPanel"
            class="doubtbot-panel"
            role="dialog"
            aria-modal="false"
            aria-labelledby="doubtbotPanelTitle"
            hidden
        >
            <header class="doubtbot-panel-header">
                <div>
                    <h4 id="doubtbotPanelTitle" class="doubtbot-panel-title mb-0">DoubtBot</h4>
                    {% if chat_ctx.enabled and chat_ctx.active_skill %}
                        <p class="doubtbot-panel-subtitle mb-0">{{ chat_ctx.active_skill.skill_name }}</p>
                    {% else %}
                        <p class="doubtbot-panel-subtitle mb-0">Playlist chat assistant</p>
                    {% endif %}
                </div>
                <button type="button" class="btn-close" aria-label="Close" id="doubtbotPanelClose"></button>
            </header>

            {% if chat_ctx.enabled %}
                <div class="doubtbot-thread" id="doubtbotThread">
                    {% if chat_ctx.messages %}
                        {% for item in chat_ctx.messages %}
                            <div class="doubtbot-bubble-row {% if item.role == 'user' %}is-user{% else %}is-assistant{% endif %}">
                                <div class="doubtbot-bubble">
                                    <div class="doubtbot-bubble-text">{{ item.message_text | replace('\n', '<br>') | safe }}</div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted small mb-0">No chat yet. Ask your first doubt.</p>
                    {% endif %}
                </div>
                <form class="doubtbot-input-wrap" method="post" action="/students/{{ student.id }}/chat/send?section={{ chat_section }}">
                    <label for="doubtbotQuestionInput" class="visually-hidden">Ask DoubtBot</label>
                    <textarea
                        id="doubtbotQuestionInput"
                        class="form-control form-control-sm doubtbot-input"
                        name="question"
                        rows="2"
                        maxlength="1000"
                        placeholder="Type your doubt..."
                        required
                    ></textarea>
                    <button type="submit" class="btn btn-sm btn-primary doubtbot-send">Send</button>
                </form>
            {% else %}
                <div class="doubtbot-unavailable">{{ chat_ctx.reason }}</div>
            {% endif %}
        </section>
    </div>
    {% endif %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        (function () {
            const notificationToggle = document.getElementById("notificationToggle");
            const notificationPanel = document.getElementById("notificationPanel");
            const profileToggle = document.getElementById("profileToggle");
            const profilePanel = document.getElementById("profilePanel");

            function setPanelState(toggle, panel, isOpen) {
                if (!toggle || !panel) return;
                panel.classList.toggle("show", isOpen);
                panel.setAttribute("aria-hidden", isOpen ? "false" : "true");
                toggle.setAttribute("aria-expanded", isOpen ? "true" : "false");
            }

            function closeAllPanels() {
                setPanelState(notificationToggle, notificationPanel, false);
                setPanelState(profileToggle, profilePanel, false);
            }

            if (notificationToggle && notificationPanel) {
                notificationToggle.addEventListener("click", (event) => {
                    event.stopPropagation();
                    const open = !notificationPanel.classList.contains("show");
                    setPanelState(notificationToggle, notificationPanel, open);
                    if (open) setPanelState(profileToggle, profilePanel, false);
                });
            }

            if (profileToggle && profilePanel) {
                profileToggle.addEventListener("click", (event) => {
                    event.stopPropagation();
                    const open = !profilePanel.classList.contains("show");
                    setPanelState(profileToggle, profilePanel, open);
                    if (open) setPanelState(notificationToggle, notificationPanel, false);
                });
            }

            document.addEventListener("click", (event) => {
                const target = event.target;
                if (!(target instanceof Element)) return;
                const insideNotification = Boolean(
                    notificationPanel && notificationPanel.contains(target)
                ) || Boolean(
                    notificationToggle && notificationToggle.contains(target)
                );
                const insideProfile = Boolean(
                    profilePanel && profilePanel.contains(target)
                ) || Boolean(
                    profileToggle && profileToggle.contains(target)
                );
                if (!insideNotification && !insideProfile) closeAllPanels();
            });

            document.addEventListener("keydown", (event) => {
                if (event.key === "Escape") closeAllPanels();
            });
        })();

        (function () {
            const dropdown = document.getElementById("ribbonPlaylistDropdown");
            const toggle = document.getElementById("ribbonPlaylistToggle");
            const panel = document.getElementById("ribbonPlaylistPanel");
            if (!dropdown || !toggle || !panel) return;

            function openPanel() {
                dropdown.classList.add("open");
                toggle.setAttribute("aria-expanded", "true");
                panel.setAttribute("aria-hidden", "false");
            }

            function closePanel() {
                dropdown.classList.remove("open");
                toggle.setAttribute("aria-expanded", "false");
                panel.setAttribute("aria-hidden", "true");
            }

            toggle.addEventListener("click", (event) => {
                event.stopPropagation();
                if (dropdown.classList.contains("open")) {
                    closePanel();
                } else {
                    openPanel();
                }
            });

            panel.addEventListener("click", (event) => {
                event.stopPropagation();
            });

            panel.querySelectorAll(".ribbon-playlist-form").forEach((form) => {
                form.addEventListener("submit", () => {
                    window.sessionStorage.setItem("keepCurrentPlaylistOpen", "1");
                });
            });

            const keepOpen = window.sessionStorage.getItem("keepCurrentPlaylistOpen") === "1";
            if (keepOpen || window.location.hash === "#current-playlist") {
                openPanel();
                window.sessionStorage.removeItem("keepCurrentPlaylistOpen");
            }

            document.addEventListener("click", closePanel);
            document.addEventListener("keydown", (event) => {
                if (event.key === "Escape") closePanel();
            });
        })();

        (function () {
            const overlay = document.getElementById("summaryModalOverlay");
            if (!overlay) return;

            const body = document.getElementById("summaryModalBody");
            const title = document.getElementById("summaryModalTitle");
            const closeBtn = document.getElementById("summaryModalClose");
            const openButtons = document.querySelectorAll(".playlist-summary-open-btn");
            let closeTimerId = null;

            function renderSummaryContent(rawContent) {
                body.innerHTML = "";
                const text = String(rawContent || "Not available.").trim();
                const lines = text
                    .split(/\r?\n/)
                    .map((line) => line.trim())
                    .filter(Boolean);

                if (!lines.length) {
                    body.textContent = "Not available.";
                    return;
                }

                lines.forEach((line) => {
                    const paragraph = document.createElement("p");
                    paragraph.className = "summary-line";

                    const bulletMatch = line.match(/^-+\s*(.+)$/);
                    const normalized = bulletMatch ? bulletMatch[1].trim() : line;
                    if (bulletMatch) paragraph.classList.add("summary-line-bullet");

                    const splitIndex = normalized.indexOf(":");
                    if (splitIndex > 0) {
                        const key = normalized.slice(0, splitIndex).trim();
                        const value = normalized.slice(splitIndex + 1).trim();

                        const keySpan = document.createElement("span");
                        keySpan.className = "summary-line-key";
                        keySpan.textContent = key + ": ";
                        paragraph.appendChild(keySpan);

                        const valueSpan = document.createElement("span");
                        valueSpan.textContent = value;
                        paragraph.appendChild(valueSpan);
                    } else {
                        paragraph.textContent = normalized;
                    }

                    body.appendChild(paragraph);
                });
            }

            function openModal(summaryTitle, encodedContent) {
                let parsed = "Not available.";
                try {
                    parsed = JSON.parse(encodedContent || "\"Not available.\"");
                } catch (error) {
                    parsed = "Not available.";
                }

                title.textContent = summaryTitle || "Summary";
                renderSummaryContent(parsed);
                if (closeTimerId !== null) {
                    window.clearTimeout(closeTimerId);
                    closeTimerId = null;
                }
                const wasHidden = !overlay.classList.contains("show");
                overlay.classList.remove("closing");
                if (wasHidden) {
                    void overlay.offsetWidth;
                    overlay.classList.add("show");
                }
                overlay.classList.add("show");
                overlay.setAttribute("aria-hidden", "false");
                document.body.classList.add("summary-modal-open");
            }

            function closeModal() {
                if (!overlay.classList.contains("show") || closeTimerId !== null) return;
                overlay.classList.add("closing");
                closeTimerId = window.setTimeout(() => {
                    overlay.classList.remove("show", "closing");
                    overlay.setAttribute("aria-hidden", "true");
                    document.body.classList.remove("summary-modal-open");
                    closeTimerId = null;
                }, 230);
            }

            openButtons.forEach((button) => {
                button.addEventListener("click", () => {
                    openModal(
                        button.getAttribute("data-summary-title"),
                        button.getAttribute("data-summary-content"),
                    );
                });
            });

            closeBtn?.addEventListener("click", closeModal);
            overlay.addEventListener("click", (event) => {
                if (event.target === overlay) closeModal();
            });
            document.addEventListener("keydown", (event) => {
                if (event.key === "Escape" && overlay.classList.contains("show")) closeModal();
            });
        })();

        (function () {
            const widget = document.getElementById("doubtbot-widget");
            const launcher = document.getElementById("doubtbotLauncher");
            const panel = document.getElementById("doubtbotPanel");
            const closeBtn = document.getElementById("doubtbotPanelClose");
            const thread = document.getElementById("doubtbotThread");
            const input = document.getElementById("doubtbotQuestionInput");
            const form = widget?.querySelector(".doubtbot-input-wrap");

            if (!widget || !launcher || !panel) return;

            function scrollThreadToBottom() {
                if (!thread) return;
                thread.scrollTop = thread.scrollHeight;
            }

            function openPanel() {
                if (!panel.hidden && panel.classList.contains("is-visible") && !panel.classList.contains("closing")) {
                    return;
                }
                panel.hidden = false;
                panel.classList.remove("closing");
                void panel.offsetWidth;
                panel.classList.add("is-visible");
                widget.classList.add("open");
                launcher.setAttribute("aria-expanded", "true");
                scrollThreadToBottom();
                window.setTimeout(() => input?.focus(), 120);
            }

            function closePanel() {
                if (panel.hidden || panel.classList.contains("closing")) return;
                panel.classList.remove("is-visible");
                panel.classList.add("closing");
                widget.classList.remove("open");
                launcher.setAttribute("aria-expanded", "false");
                panel.addEventListener(
                    "animationend",
                    (event) => {
                        if (event.animationName !== "doubtbot-panel-close") return;
                        panel.hidden = true;
                        panel.classList.remove("closing");
                    },
                    { once: true },
                );
            }

            launcher.addEventListener("click", (event) => {
                event.stopPropagation();
                if (panel.hidden) openPanel();
            });

            panel.addEventListener("click", (event) => {
                event.stopPropagation();
            });

            widget.addEventListener("click", (event) => {
                event.stopPropagation();
            });

            form?.addEventListener("submit", () => {
                window.sessionStorage.setItem("keepDoubtbotOpen", "1");
            });

            closeBtn?.addEventListener("click", closePanel);
            document.addEventListener("click", closePanel);
            document.addEventListener("keydown", (event) => {
                if (event.key === "Escape" && !panel.hidden) closePanel();
            });

            const keepOpen = window.sessionStorage.getItem("keepDoubtbotOpen") === "1";
            if (keepOpen || window.location.hash === "#doubtbot-widget") {
                openPanel();
                window.sessionStorage.removeItem("keepDoubtbotOpen");
            }
        })();

    </script>
</body>
</html>


